<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>    
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="${pageContext.request.contextPath }/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script src="${pageContext.request.contextPath }/js/bootstrap.min.js"></script>

<title>Insert title here</title>

<style type="text/css">
:root {
  /* COLORS */
  --white: #e9e9e9;
  --gray: #333;
  --blue: #0367a6;
  --lightblue: #008997;

  /* RADII */
  --button-radius: 0.7rem;

  /* SIZES */
  --max-width: 900px;
  --max-height: 800px;

  font-size: 16px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
}

body {
  align-items: center;
  background-color: var(--white);
  background: url("${pageContext.request.contextPath }/images/wallpaperbetter.jpg");
  background-attachment: fixed;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  display: grid;
  height: 100vh;
  place-items: center;
}

.form__title {
  font-weight: 300;
  margin: 0;
  margin-bottom: 1.25rem;
}

.link {
  color: var(--gray);
  font-size: 0.9rem;
  margin: 1.5rem 0;
  text-decoration: none;
}

.container {
  background-color: var(--white);
  border-radius: var(--button-radius);
  box-shadow: 0 0.9rem 1.7rem rgba(0, 0, 0, 0.25),
    0 0.7rem 0.7rem rgba(0, 0, 0, 0.22);
  height: var(--max-height);
  max-width: var(--max-width);
  overflow: hidden;
  position: relative;
  width: 100%;
}

.container__form {
  height: 100%;
  position: absolute;
  top: 0;
  transition: all 0.6s ease-in-out;
}

.container--signin {
  left: 0;
  width: 50%;
  z-index: 2;
}

.container.right-panel-active .container--signin {
  transform: translateX(100%);
}

.container--signup {
  left: 0;
  opacity: 0;
  width: 50%;
  z-index: 1;
}

.container.right-panel-active .container--signup {
  animation: show 0.6s;
  opacity: 1;
  transform: translateX(100%);
  z-index: 5;
}

.container__overlay {
  height: 100%;
  left: 50%;
  overflow: hidden;
  position: absolute;
  top: 0;
  transition: transform 0.6s ease-in-out;
  width: 50%;
  z-index: 100;
}

.container.right-panel-active .container__overlay {
  transform: translateX(-100%);
}

.overlay {
  background-color: var(--lightblue);
  background: url("${pageContext.request.contextPath }/images/wallpaperbetter.jpg");
  background-attachment: fixed;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  height: 100%;
  left: -100%;
  position: relative;
  transform: translateX(0);
  transition: transform 0.6s ease-in-out;
  width: 200%;
}

.container.right-panel-active .overlay {
  transform: translateX(50%);
}

.overlay__panel {
  align-items: center;
  display: flex;
  flex-direction: column;
  height: 100%;
  justify-content: center;
  position: absolute;
  text-align: center;
  top: 0;
  transform: translateX(0);
  transition: transform 0.6s ease-in-out;
  width: 50%;
}

.overlay--left {
  transform: translateX(-20%);
}

.container.right-panel-active .overlay--left {
  transform: translateX(0);
}

.overlay--right {
  right: 0;
  transform: translateX(0);
}

.container.right-panel-active .overlay--right {
  transform: translateX(20%);
}

.btn {
  background-color: var(--blue);
  background-image: linear-gradient(90deg, var(--blue) 0%, var(--lightblue) 74%);
  border-radius: 20px;
  border: 1px solid var(--blue);
  color: var(--white);
  cursor: pointer;
  font-size: 0.8rem;
  font-weight: bold;
  letter-spacing: 0.1rem;
  padding: 0.9rem 4rem;
  text-transform: uppercase;
  transition: transform 80ms ease-in;
}

.form > .btn {
  margin-top: 1.5rem;
}

.btn:active {
  transform: scale(0.95);
}

.btn:focus {
  outline: none;
}

.form {
  background-color: var(--white);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  padding: 0 3rem;
  height: 100%;
  text-align: center;
}

.input {
  background-color: #fff;
  border: none;
  padding: 0.9rem 0.9rem;
  margin: 1.0rem 0;
  width: 100%;
}

#form1 div{
	width: 100%;
}

@keyframes show {
  0%,
  49.99% {
    opacity: 0;
    z-index: 1;
  }

  50%,
  100% {
    opacity: 1;
    z-index: 5;
  }
}





/*버튼 css 입히기  */
#check_id{
	position: absolute;
	background-image: linear-gradient(90deg, var(--blue) 0%, var(--lightblue) 74%);
	top: 201px;
	left: 340px;
	width: 60px;
	height: 25px;	
    color: #fff;
    border: none;
    border-radius: 5px;
    background-color: var(--blue);
}

/*버튼 css 입히기  */
#mailAuth{
	position: absolute;
	background-image: linear-gradient(90deg, var(--blue) 0%, var(--lightblue) 74%);
	bottom: 325px;
	left: 300px;
	width: 97px;
	height: 25px;	
    color: #fff;
    border: none;
    border-radius: 5px;
    background-color: var(--blue);
}



</style>
 
 <script type="text/javascript">
//아이디 체크 비동기 함수
 function fn_checkId() {
 	 //alert("fn_checkId");
 	console.log("memberId : ", $("#memberId").val());
 	
 	
 	$.ajax({
 		 url:"<c:url value='/join/idCheck'/>"
 		,type:"post"
 		,data:{"memberId" : $("#memberId").val() }
 		,success: function(data) {
 			console.log("아이디 체크 : ", data);
 		     
 			let txt = $('#memberId').val()
 		     if (txt == '') {
 		          alert('ID를 입력해주세요')
 		     }
 		     else if(data){
	 				alert("사용가능한 아이디 입니다!");
	 			}else{
	 				$("#memberId").val("");
	 				alert("이미 사용중인 아이디 입니다. 다른 아이디를 사용해주세요")
	 			}
          }
 		,error: function() {
 			alert("error")
 			
 		}
 	});
 	
 	
 }
 
 
 
 
 /* validation 쓰려면 이게 필요합니다 왠지는 저두 잘,,복붙했어요,, */
 (function() {
	  "use strict";
	  window.addEventListener("load", function() {
	    var form = document.getElementById("form1");
	    form.addEventListener("submit", function(event) {
	      if (form.checkValidity() == false) {
	        event.preventDefault();
	        event.stopPropagation();
	        form.classList.add("was-validated");
	      }
	      
	      // 서버 연동 처리
	    }, false);
	  }, false);
	}());
 
 
 /* password 일치하는지 검증하는거 */ 
 $(document).ready(function(){
	$(".pw").keyup(function(){
 	let pass1 = $("#memberPass").val();
     let pass2 = $("#memberPassCheck").val();
     
     if (pass1 != "" || pass2 != ""){
     	if (pass1 == pass2){
         	$("#checkPw").html('비밀번호가 일치합니다');
         	$("#checkPw").attr('color','green');
         } else {
         	$("#checkPw").html('비밀번호가 일치하지 않습니다.');
             $("#checkPw").attr('color','red');
         }
     }
 
 	})
 })
 

 // 메일버튼 클릭시 이벤트
$("#mailAuth").on("click", function() {
	console.log("#mailAuth");
	
	// 여기서 메일을 확인할 것이다
	let memberMailAuthYn = $("#memberMailAuthYn");
	console.log("memberMailAuthYn : ", memberMailAuthYn.val())
	
	// 메일 검증
    let checkMemMail = /^[-_a-zA-z0-9]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,4}$/i;
    console.log("checkMemMail: ", checkMemMail.test(memberMailAuthYn.val()) );
    if( ! checkMemMail.test(memberMailAuthYn.val()) ){
    	alert("이메일 양식이 틀립니다. 다시 입력해주세요"); 
    	memberMailAuthYn.val("");    	
    	memberMailAuthYn.next("label").addClass("warning");
       return;
    }
	
	
	
	$.ajax({
		url : "<c:url value='/join/mailAuth'/>"
		,type : "post"
		,data : {"mail" : memberMailAuthYn.val()}
		,success : function(data) {
			// alert("success");
			console.log("data : ", data);
			
			// 인증 확인하는 창 띄우기
			let popupWidth = 600;
			let popupHeight = 150;
			let winWidth = document.body.offsetWidth;
			let winHeight = document.body.offsetHeight;
			let popupX = (winWidth/2) - (popupWidth/2);  
			let popupY = (winHeight/2) - (popupHeight/2);

			if(data){
				let myWin = window.open("<c:url value='/join/mailWindow'/>" 
					,"mywin"
					,"left="+popupX+"px,"
					+"top="+popupY+"px, "
					+"width="+popupWidth+"px, "
					+"height="+popupHeight+"px");
			}
		}
		,error : function() {
			alert("error");
		}
		// ajax 처리하는 동안 빙글빙글 돌아가는 이미지 띄어주는거
		,beforeSend: function() {
			let width = 150;
			let height = 150;
			let top = 50;
			let left = 50;
			$('body').append('<div id="div_ajax_load_image" style="position:absolute; top:' 
				+ top + '%; left:' 
				+ left + '%; width:' 
				+ width + 'px; height:' 
				+ height + 'px; z-index:9999;'
				+'background:transparent; '
				+'filter:alpha(opacity=50); '
				+'opacity:alpha*0.5; '
				+'margin:auto; '
				+'padding:0; ">'
				+'<img src="<c:url value ='/images/ajax_loader6.gif'/>"'
				+'style="width:150px; height:150px;"></div>');
		}
		,complete: function() {
			$("#div_ajax_load_image").remove();
		}
	});
	
});
 
 
 </script>
 
 
</head>
<body>
<div class="container right-panel-active">
  <!-- Sign Up -->
  <div class="container__form container--signup">
    <form action="#" class="form needs-validation" id="form1" novalidate="">
      <h2 class="form__title">Sign Up</h2>
      
      
      <!-- 사용자 이름과 이름 validation -->
		<div>
			<input type="text" name="memberNm" placeholder="memberNm" placeholder="NAME" class="input form-control" required pattern="[a-zA-Z]{3,15}"/>
				<div class="valid-feedback">
					사용 가능한 이름입니다!
				</div>
				<div class="invalid-feedback">
					이름은 영문자 3 ~ 15자리 입니다.
				</div>
		</div>
		
		<!-- ID와 ID 인증버튼 -->
		<div>
	      <input type="text" id="memberId" name="memberId" placeholder="ID" class="input form-control" required pattern="[a-zA-Z]{4,10}"/>
		      <div class="valid-feedback">
		           사용 가능한 아이디입니다!
		      </div>
		      <div class="invalid-feedback">
		          ID는  영문자 4 ~ 10자리 입니다.
		      </div>
		      <button type="button" id="check_id" name="check_id" onclick="fn_checkId()" >ID확인</button>
      </div>
      
      <!-- password와 password 검증 -->
      <input type="password" id="memberPass" name="memberPass" placeholder="PASSWORD" class="input pw" />
      <div>
      <input type="password" id="memberPassCheck" name="memberPassCheck" placeholder="RECONFIRM PASSWORD" class="input pw" />
      	<font id = "checkPw" size = "2"></font>
      </div>

      
      
	<!-- 이메일과 이메일 인증 버튼  -->
      <input type="text" placeholder="E-MAIL" class="input" />
      <button type="button" id="mailAuth" name="mailAuth" onclick="fn_checkEmail()">EMAIL인증</button>
      
      <!-- 주소, 전화번호 -->
      <input type="text" id="memberAdd" name="memberAdd" placeholder="ADDRESS" class="input" />
      <input type="text" id="memberHp" name="memberHp" placeholder="HP" class="input" />
      
      
      <!-- 가입 버튼 -->
      <button class="btn" type="submit">Sign Up</button>
    </form>
  </div>

  <!-- Sign In -->
  <div class="container__form container--signin">
    <form action="#" class="form" id="form2">
      <h2 class="form__title">Sign In</h2>
      <input type="email" placeholder="Email" class="input" />
      <input type="password" placeholder="Password" class="input" />
      <a href="#" class="link">Forgot your password?</a>
      <button class="btn">Sign In</button>
    </form>
  </div>

  <!-- Overlay 버튼을 누르면 로그인 창과 회원가입 창을 왔다리 갔다리 할 수 있삼  -->
  <div class="container__overlay">
    <div class="overlay">
      <div class="overlay__panel overlay--left">
        <button class="btn" id="signIn">Sign In</button>
      </div>
      <div class="overlay__panel overlay--right">
        <button class="btn" id="signUp">Sign Up</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">

const signInBtn = document.getElementById("signIn");
const signUpBtn = document.getElementById("signUp");
const fistForm = document.getElementById("form1");
const secondForm = document.getElementById("form2");
const container = document.querySelector(".container");

/* 이거 빨간색 x표시 떠도 오류난거 아니에용 왜그런지는 저도 잘 모르겠지만 잘 돌아갑니당~_~ */
signInBtn.addEventListener("click", () => {
	  container.classList.remove("right-panel-active");
	});

	signUpBtn.addEventListener("click", () => {
	  container.classList.add("right-panel-active");
	});

	fistForm.addEventListener("submit", (e) => e.preventDefault());
	secondForm.addEventListener("submit", (e) => e.preventDefault());


</script>




</body>
</html>